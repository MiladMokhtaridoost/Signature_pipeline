# Overview

In order to run Signature's LWLR, the input data needs to be in a human-readable, signature-friendly format. Outlined here are the 4 main steps invovled in pre-processing the raw Hi-C data for use in Signature's LWLR. 

# 1. BWA

We mapped raw Hi-C paired-reads to the GRCh38 version 32 of the human reference genome using bwa (version 0.7.17; mem)[1]. We determined mapping statistics using samtools (version 1.5; view, flagstat)[2]. 

# 2. pairtools

Pairtools requires mapped Hi-C reads in .bam file format. We filtered for valid Hi-C and Omni-C alignments by using pairtools (version 0.3.0; parse, sort, dedup, select ‘(pair_type == "UU") or (pair_type == "UR") or (pair_type == "RU")’ , split, select 'True') (https://github.com/open2c/pairtools). Indexing of the resulting pairs was done with the pairix program which was developed for the 4D Nucleome consortium and indexes .pairs files (version 0.3.7) (https://github.com/4dn-dcic/pairix).

# 3. cooler

We converted the matched and filtered interaction pairs produced from pairtools into a readable and normalized contact matrix by using Cooler (version 0.8.11; cload pairix, balance, dump)[3]. After running cooler, _coolerdumpToSignature.py_ is required to convert from cooler format to a signature-friendly format. __This script is included in this folder.__ We ensured (FIX THIS SENTENCE JORDAN) pseudo-chromosome Y reads were removed from all female cooler data (see _gonosomes_ section below).

### coolerdumpToSignature.py
Arguments:
1. Pathway and file name to cooler dumped tab separated file
2. Output pathway
3. Resolution

# 4. gonosomes

We utilized logistic regression on the SAM files of datasets with known sex to train a classifier. This classifier was trained on the proportion of gonosome-mapped reads to autosome-mapped reads. We then applied the trained classifier to predict the sex of datasets without sex labels. __These scripts are included in this folder.__ First, _gonosome_PMR.sh_ is used to generate the proportional mapped reads (PMR) file for each unknown dataset. Then, _gonosome_prediction_LogisticRegression.sh_ is used to format the PMR data and run it through the logistic regression model.

### gonosome_PMR.sh
Required modules:
   - python/3.8.1
   - perl/5.28.0

Arguments:
1. The sample/dataset name being processed
2. Pathway to the .sam files generated by BWA
3. Pathway to the extracted directory /.../Signature-main/Pipeline/Pre-Processing_HiC
4. The hg38.chrom.sizes (two-column tab-separated text file from the hg38 assembly)
5. A text contains each chromosome number (i.e. chr1) on a separate line in order from smallest to largest (length).

### gonosome_prediction_LogisticRegression.sh
Required modules:
   - R/4.2.1

Arguments:
1. Pathway to the extracted directory /.../Signature-main/Pipeline/Pre-Processing_HiC
2. Pathway and file name of a single column text file containing a list of your samples/datasets with unknown gonosomal sex (these datasets shoud have their corresponding PMR files already produced in output folder from the above script)






# Sources

[1] Li, H. & Durbin, R. Fast and accurate short read alignment with Burrows-Wheeler transform. Bioinformatics 25, 1754-1760 (2009). https://doi.org:10.1093/bioinformatics/btp324

[2] Li, H. et al. The Sequence Alignment/Map format and SAMtools. Bioinformatics 25, 2078-2079 (2009). https://doi.org:10.1093/bioinformatics/btp352

[3] Abdennur, N. & Mirny, L. A. Cooler: scalable storage for Hi-C data and other genomically labeled arrays. Bioinformatics 36, 311-316 (2020). https://doi.org:10.1093/bioinformatics/btz540



